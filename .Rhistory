ACMTF_models_correct[[1]]$Fac[[8]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + scale_y_discrete(name="X block", labels=c("X3", "X2", "X1")) + ggtitle("Lambdas (correct model)")
ACMTF_models_incorrect[[1]]$Fac[[8]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + scale_y_discrete(name="X block", labels=c("X3", "X2", "X1")) + ggtitle("Lambdas (incorrect model)")
model = ACMTF_models_correct[[1]]
cor(model$Fac[[1]], inputLoadings[[1]])
model = ACMTF_models_correct[[1]]
empty = ggplot()
# Block X1
a = cbind(inputLoadings[[1]][,1], model$Fac[[1]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("PARAFAC") + ggtitle("Global 1")
b = cbind(inputLoadings[[1]][,2], model$Fac[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Global 2")
c = cbind(inputLoadings[[1]][,3], model$Fac[[1]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 1")
d = cbind(inputLoadings[[1]][,4], model$Fac[[1]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 2")
e = cbind(inputLoadings[[1]][,5], model$Fac[[1]][,6]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 1")
f = cbind(inputLoadings[[1]][,6], model$Fac[[1]][,7]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 2")
g = cbind(inputLoadings[[1]][,7], model$Fac[[1]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 3")
plot = ggarrange(a,b,c,d,e,f)
annotate_figure(plot, top = text_grob("Subject loadings"))
annotate_figure(plot, top = text_grob("Subject loadings"))
model = ACMTF_models_correct[[1]]
a = cbind(inputLoadings[[1]][,1], model$Fac[[1]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("PARAFAC") + ggtitle("Global 1")
b = cbind(inputLoadings[[1]][,2], model$Fac[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Global 2")
c = cbind(inputLoadings[[1]][,3], model$Fac[[1]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 1")
d = cbind(inputLoadings[[1]][,4], model$Fac[[1]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 2")
e = cbind(inputLoadings[[1]][,5], model$Fac[[1]][,6]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 1")
f = cbind(inputLoadings[[1]][,6], model$Fac[[1]][,7]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 2")
g = cbind(inputLoadings[[1]][,7], model$Fac[[1]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 3")
plot = ggarrange(a,b,c,d,e,f,g)
annotate_figure(plot, top = text_grob("Subject loadings"))
cor(model$Fac[[2]], inputLoadings[[2]])
a = cbind(inputLoadings[[1]][,1], model$Fac[[1]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF") + ggtitle("Global 1")
b = cbind(inputLoadings[[1]][,2], model$Fac[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Global 2")
c = cbind(inputLoadings[[1]][,3], model$Fac[[1]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 1")
d = cbind(inputLoadings[[1]][,4], model$Fac[[1]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 2")
e = cbind(inputLoadings[[1]][,5], model$Fac[[1]][,6]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 1")
f = cbind(inputLoadings[[1]][,6], model$Fac[[1]][,7]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 2")
g = cbind(inputLoadings[[1]][,7], model$Fac[[1]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 3")
plot = ggarrange(a,b,c,d,e,f,g, nrow=1, ncol=7)
annotate_figure(plot, top = text_grob("Subject loadings (correct model)"))
cor(model$Fac[[4]], inputLoadings[[2]])
cor(model$Fac[[6]], inputLoadings[[2]])
model = ACMTF_models_correct[[1]]
empty = ggplot()
cor(model$Fac[[2]], inputLoadings[[2]])
cor(model$Fac[[4]], inputLoadings[[2]])
cor(model$Fac[[6]], inputLoadings[[2]])
# Block X1
a = cbind(inputLoadings[[2]][,1], pfac1$Fac[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF") + ggtitle("Global 1")
b = cbind(inputLoadings[[2]][,4], pfac1$Fac[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Global 2")
c = cbind(inputLoadings[[2]][,7], pfac1$Fac[[2]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 1")
d = cbind(inputLoadings[[2]][,9], pfac1$Fac[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 2")
e = cbind(inputLoadings[[2]][,11], pfac1$Fac[[2]][,6]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 1")
model = ACMTF_models_correct[[1]]
empty = ggplot()
cor(model$Fac[[2]], inputLoadings[[2]])
cor(model$Fac[[4]], inputLoadings[[2]])
cor(model$Fac[[6]], inputLoadings[[2]])
# Block X1
a = cbind(inputLoadings[[2]][,1], model$Fac[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF") + ggtitle("Global 1")
b = cbind(inputLoadings[[2]][,4], model$Fac[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Global 2")
c = cbind(inputLoadings[[2]][,7], model$Fac[[2]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 1")
d = cbind(inputLoadings[[2]][,9], model$Fac[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 2")
e = cbind(inputLoadings[[2]][,11], model$Fac[[2]][,6]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 1")
f = empty + ggtitle("Distinct 2")
g = empty + ggtitle("Distinct 3")
# Block X2
h = cbind(inputLoadings[[2]][,2], model$Fac[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF")
i = cbind(inputLoadings[[2]][,5], model$Fac[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
j = cbind(inputLoadings[[2]][,8], model$Fac[[2]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
k = cbind(inputLoadings[[2]][,10], model$Fac[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
l = empty
m = cbind(inputLoadings[[2]][,12], model$Fac[[2]][,7]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
n = empty
# Block X3
o = cbind(inputLoadings[[2]][,3], model$Fac[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF")
p = cbind(inputLoadings[[2]][,6], model$Fac[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
q = empty
r = empty
s = empty
t = empty
u = cbind(inputLoadings[[2]][,13], model$Fac[[2]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
plot = ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u, nrow=3, ncol=7)
annotate_figure(plot, top = text_grob("Feature loadings (correct model)"))
annotate_figure(plot, top = text_grob("Feature loadings (correct model)"))
cor(model$Fac[[4]], inputLoadings[[2]])
model = ACMTF_models_correct[[1]]
empty = ggplot()
cor(model$Fac[[2]], inputLoadings[[2]])
cor(model$Fac[[4]], inputLoadings[[2]])
cor(model$Fac[[6]], inputLoadings[[2]])
# Block X1
a = cbind(inputLoadings[[2]][,1], model$Fac[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF") + ggtitle("Global 1")
b = cbind(inputLoadings[[2]][,4], model$Fac[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Global 2")
c = cbind(inputLoadings[[2]][,7], model$Fac[[2]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 1")
d = cbind(inputLoadings[[2]][,9], model$Fac[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 2")
e = cbind(inputLoadings[[2]][,11], model$Fac[[2]][,6]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 1")
f = empty + ggtitle("Distinct 2")
g = empty + ggtitle("Distinct 3")
# Block X2
h = cbind(inputLoadings[[2]][,2], model$Fac[[4]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF")
i = cbind(inputLoadings[[2]][,5], model$Fac[[4]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
j = cbind(inputLoadings[[2]][,8], model$Fac[[4]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
k = cbind(inputLoadings[[2]][,10], model$Fac[[4]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
l = empty
m = cbind(inputLoadings[[2]][,12], model$Fac[[4]][,7]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
n = empty
# Block X3
o = cbind(inputLoadings[[2]][,3], model$Fac[[6]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF")
p = cbind(inputLoadings[[2]][,6], model$Fac[[6]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
q = empty
r = empty
s = empty
t = empty
u = cbind(inputLoadings[[2]][,13], model$Fac[[6]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
plot = ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u, nrow=3, ncol=7)
annotate_figure(plot, top = text_grob("Feature loadings (correct model)"))
annotate_figure(plot, top = text_grob("Feature loadings (correct model)"))
cor(model$Fac[[3]], inputLoadings[[3]])
cor(model$Fac[[5]], inputLoadings[[3]])
cor(model$Fac[[7]], inputLoadings[[3]])
model = ACMTF_models_correct[[1]]
empty = ggplot()
cor(model$Fac[[3]], inputLoadings[[3]])
cor(model$Fac[[5]], inputLoadings[[3]])
cor(model$Fac[[7]], inputLoadings[[3]])
# Block X1
a = cbind(inputLoadings[[3]][,1], model$Fac[[3]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF") + ggtitle("Global 1")
b = cbind(inputLoadings[[3]][,4], model$Fac[[3]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Global 2")
c = cbind(inputLoadings[[3]][,7], model$Fac[[3]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 1")
d = cbind(inputLoadings[[3]][,9], model$Fac[[3]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Local 2")
e = cbind(inputLoadings[[3]][,11], model$Fac[[3]][,6]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("") + ggtitle("Distinct 1")
f = empty + ggtitle("Distinct 2")
g = empty + ggtitle("Distinct 3")
# Block X2
h = cbind(inputLoadings[[3]][,2], model$Fac[[5]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF")
i = cbind(inputLoadings[[3]][,5], model$Fac[[5]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
j = cbind(inputLoadings[[3]][,8], model$Fac[[5]][,4]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
k = cbind(inputLoadings[[3]][,10], model$Fac[[5]][,3]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
l = empty
m = cbind(inputLoadings[[3]][,12], model$Fac[[5]][,7]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
n = empty
# Block X3
o = cbind(inputLoadings[[3]][,3], model$Fac[[7]][,2]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("ACMTF")
p = cbind(inputLoadings[[3]][,6], model$Fac[[7]][,1]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
q = empty
r = empty
s = empty
t = empty
u = cbind(inputLoadings[[3]][,13], model$Fac[[7]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + xlab("Input") + ylab("")
plot = ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u, nrow=3, ncol=7)
annotate_figure(plot, top = text_grob("Time loadings (correct model)"))
annotate_figure(plot, top = text_grob("Time loadings (correct model)"))
model = ACMTF_models_incorrect[[1]]
cor(model$Fac[[1]], inputLoadings[[1]])
cor(model$Fac[[1]])
cor(model$Fac[[1]]) %>% image
cor(model$Fac[[1]]) %>% as_tibble()
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7)
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index)
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% ggplot(aes(x=index,y=name,fill=value)) + geom_tile()
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% ggplot(aes(x=index,y=name,fill=value)) + geom_tile(col="black")
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index=factor(index,levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(x=index,y=name,fill=value)) + geom_tile(col="black")
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index=factor(index,levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(x=index,y=name,fill=value)) + geom_tile(col="black") + ylab("Component number") + xlab("Component number")
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index=factor(index,levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=name,fill=value)) + geom_tile(col="black") + ylab("Component number") + xlab("Component number")
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index=factor(index,levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=name,fill=value)) + geom_tile(col="black") + ylab("Component number") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2)))
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index=factor(index,levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=name,fill=value)) + geom_tile(col="black") + ylab("Component number") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ggtitle("Subject loading cor (incorrect model)")
cor(ACMTF_models_correct[[1]]$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index=factor(index,levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=name,fill=value)) + geom_tile(col="black") + ylab("Component number") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ggtitle("Subject loading cor (incorrect model)")
cor(ACMTF_models_correct[[1]]$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index=factor(index,levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=name,fill=value)) + geom_tile(col="black") + ylab("Component number") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ggtitle("Subject loading cor (correct model)")
cor(ACMTF_models_correct[[1]]$Fac[[2]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index=factor(index,levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=name,fill=value)) + geom_tile(col="black") + ylab("Component number") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ggtitle("Subject loading cor (correct model)")
model = ACMTF_models_incorrect[[1]]
model$Fac[[2]]
cor(model$Fac[[2]], inputLoadings[[2]])
round(cor(model$Fac[[2]], inputLoadings[[2]]), 2)
round(cor(model$Fac[[4]], inputLoadings[[2]]), 2)
round(cor(model$Fac[[6]], inputLoadings[[2]]), 2)
cor(model$Fac[[1]], inputLoadings[[1]])
round(cor(model$Fac[[3]], inputLoadings[[3]]), 2)
round(cor(model$Fac[[5]], inputLoadings[[3]]), 2)
round(cor(model$Fac[[7]], inputLoadings[[3]]), 2)
model$Fac[[8]]
round(model$Fac[[8]], 2)
model$Fac[[1]][,c(3,5,6)]
cbind(model$Fac[[1]][,3], model$Fac[[1]][,5]) %>% as_tibble()
cbind(model$Fac[[1]][,3], model$Fac[[1]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point()
cbind(model$Fac[[1]][,3], model$Fac[[1]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + ggtitle("Subject loadings")
cor(model$Fac[[2]])
cor(model$Fac[[1]], inputLoadings[[1]])
cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble()
cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7)
cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index)
cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2)))
cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2)))
cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + xlab("Input") + ylab("Component number")
cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number") + scale_x_discrete(name="Input", labels=c("Global1", "Global2", "Local1", "Local2", "Distinct1", "Distinct2", "Distinct3"))
cor(model$Fac[[1]][,c(3,5,6)], inputLoadings[[1]][,1])
cor(model$Fac[[2]][,3], inputLoadings[[2]])
model = ACMTF_models_incorrect[[1]]
b= ACMTF_models_incorrect[[1]]$Fac[[8]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + scale_y_discrete(name="X block", labels=c("X3", "X2", "X1")) + ggtitle("Lambdas (incorrect model)")
c = cbind(model$Fac[[1]][,3], model$Fac[[1]][,5]) %>% as_tibble() %>% ggplot(aes(x=V1,y=V2)) + geom_point() + ggtitle("Subject loadings")
b
c
model$Fac[[1]]
cor(model$Fac[[1]])
cor(model$Fac[[1]]) %>% as_tibble()
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7)
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2)))
cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
model = ACMTF_models_incorrect[[1]]
a = cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
b = model$Fac[[8]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + scale_y_discrete(name="X block", labels=c("X3", "X2", "X1")) + ggtitle("Lambdas (incorrect model)")
c = cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
ggarrange(a,b,c)
c
cor(model$Fac[[1]], inputLoadings[[1]])
cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1])
cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble()
cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1))
cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point()
cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("Global1") + ylab("Component 3")
cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("Global1") + ylab("Component 3") + ggtitle("Subject loadings")
cbind(model$Fac[[1]][,5], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("Global1") + ylab("Component 3") + ggtitle("Subject loadings")
cbind(model$Fac[[1]][,6], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("Global1") + ylab("Component 3") + ggtitle("Subject loadings")
cor(model$Fac[[2]][,3], inputLoadings[[2]])
cbind(model$Fac[[2]][,3], inputLoadings[[2]][,4]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("Global2_X1") + ylab("Component 3") + ggtitle("Subject loadings")
cbind(model$Fac[[3]][,3], inputLoadings[[3]])
cor(model$Fac[[3]][,3], inputLoadings[[3]])
a = cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("Global1") + ylab("Component 3") + ggtitle("Subject loadings")
b = cbind(model$Fac[[2]][,3], inputLoadings[[2]][,4]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global2_X1") + ylab("Component 3") + ggtitle("Feature loadings")
c = cbind(model$Fac[[3]][,3], inputLoadings[[3]][,4]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global2_X1") + ylab("Component 3") + ggtitle("Feature loadings")
ggarrange(a,b,c)
cor(model$Fac[[4]][,3], inputLoadings[[2]])
cor(model$Fac[[5]][,3], inputLoadings[[3]])
cor(model$Fac[[6]][,3], inputLoadings[[2]])
cbind(model$Fac[[6]][,3], inputLoadings[[3]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X3") + ylab("Component 3") + ggtitle("Feature loadings")
cbind(model$Fac[[6]][,3], inputLoadings[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X3") + ylab("Component 3") + ggtitle("Feature loadings")
cor(model$Fac[[7]][,3], inputLoadings[[3]])
a = cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("Global1") + ylab("Component 3") + ggtitle("Subject loadings")
b = cbind(model$Fac[[2]][,3], inputLoadings[[2]][,4]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global2_X1") + ylab("Component 3") + ggtitle("Feature loadings")
c = cbind(model$Fac[[3]][,3], inputLoadings[[3]][,4]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global2_X1") + ylab("Component 3") + ggtitle("Feature loadings")
d = empty
e = empty
f = cbind(model$Fac[[6]][,3], inputLoadings[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X3") + ylab("Component 3") + ggtitle("Feature loadings")
g = cbind(model$Fac[[7]][,3], inputLoadings[[3]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X3") + ylab("Component 3") + ggtitle("Feature loadings")
ggarrange(a,b,c,d,e,f,g)
a = cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("Global1") + ylab("Component 3") + ggtitle("Subject loadings")
b = empty
c = empty
d = empty
e = empty
f = cbind(model$Fac[[6]][,3], inputLoadings[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X3") + ylab("Component 3") + ggtitle("Feature loadings")
g = cbind(model$Fac[[7]][,3], inputLoadings[[3]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X3") + ylab("Component 3") + ggtitle("Feature loadings")
ggarrange(a,b,c,d,e,f,g)
cor(model$Fac[[4]][,5], inputLoadings[[2]])
h = cbind(model$Fac[[1]][,5], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 5") + ggtitle("Subject loadings")
i = empty
j = empty
k = cbind(model$Fac[[1]][,5], inputLoadings[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X2") + ylab("Component 5") + ggtitle("Subject loadings")
l = cbind(model$Fac[[1]][,5], inputLoadings[[3]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X2") + ylab("Component 5") + ggtitle("Subject loadings")
m = empty
n = empty
ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n, nrow=2, ncol=3)
a = cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 3") + ggtitle("Subject loadings")
b = empty
c = empty
d = empty
e = empty
f = cbind(model$Fac[[6]][,3], inputLoadings[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X3") + ylab("Component 3") + ggtitle("Feature loadings")
g = cbind(model$Fac[[7]][,3], inputLoadings[[3]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X3") + ylab("Component 3") + ggtitle("Feature loadings")
## Component 5
h = cbind(model$Fac[[1]][,5], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 5") + ggtitle("Subject loadings")
i = empty
j = empty
k = cbind(model$Fac[[1]][,5], inputLoadings[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X2") + ylab("Component 5") + ggtitle("Subject loadings")
l = cbind(model$Fac[[1]][,5], inputLoadings[[3]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X2") + ylab("Component 5") + ggtitle("Subject loadings")
m = empty
n = empty
ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n, nrow=2, ncol=3)
ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n, nrow=2, ncol=7)
k = cbind(model$Fac[[4]][,5], inputLoadings[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X2") + ylab("Component 5") + ggtitle("Subject loadings")
l = cbind(model$Fac[[5]][,5], inputLoadings[[3]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X2") + ylab("Component 5") + ggtitle("Subject loadings")
ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n, nrow=2, ncol=7)
o = cbind(model$Fac[[1]][,6], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 6") + ggtitle("Subject loadings")
p = cbind(model$Fac[[2]][,6], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X1") + ylab("Component 6") + ggtitle("Subject loadings")
q = cbind(model$Fac[[3]][,6], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X1") + ylab("Component 6") + ggtitle("Subject loadings")
r = empty
s = empty
t = empty
u = empty
ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u, nrow=3, ncol=7)
o = cbind(model$Fac[[1]][,6], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 6") + ggtitle("Subject loadings")
p = cbind(model$Fac[[2]][,6], inputLoadings[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X1") + ylab("Component 6") + ggtitle("Subject loadings")
q = cbind(model$Fac[[3]][,6], inputLoadings[[3]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X1") + ylab("Component 6") + ggtitle("Subject loadings")
r = empty
s = empty
t = empty
u = empty
ggarrange(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u, nrow=3, ncol=7)
## Component 3
a = cbind(model$Fac[[1]][,3], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 3")
b = cbind(model$Fac[[6]][,3], inputLoadings[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X3") + ylab("")
c = cbind(model$Fac[[7]][,3], inputLoadings[[3]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X3") + ylab("")
## Component 5
d = cbind(model$Fac[[1]][,5], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 5")
e = cbind(model$Fac[[4]][,5], inputLoadings[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X2") + ylab("")
f = cbind(model$Fac[[5]][,5], inputLoadings[[3]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X2") + ylab("")
## Component 6
g = cbind(model$Fac[[1]][,6], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 6")
h = cbind(model$Fac[[2]][,6], inputLoadings[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X1") + ylab("")
i = cbind(model$Fac[[3]][,6], inputLoadings[[3]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X1") + ylab("")
ggarrange(a,b,c,d,e,f,g,h,i, nrow=3, ncol=3)
ACMTF_CV_models = readRDS("./20241203_ACMTF_CV_models_Y_inside.RDS")
ACMTF_CV_params = readRDS("./20241203_ACMTF_CV_params_Y_inside.RDS")
ACMTF_CV_varExps = do.call(rbind, lapply(ACMTF_CV_models, FUN=function(x){(x$varExp)})) %>% as_tibble()
colnames(ACMTF_CV_varExps) = c("X1", "X2", "X3")
ACMTF_CV_varExps = ACMTF_CV_varExps %>% mutate(beta = ACMTF_CV_params)
a = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + scale_x_log10()
b = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X2)) + geom_point() + scale_x_log10()
c = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X3)) + geom_point() + scale_x_log10()
ggarrange(a,b,c,nrow=3)
ggarrange(a,b,c,nrow=3)
ACMTF_CV_varExps = do.call(rbind, lapply(ACMTF_CV_models, FUN=function(x){(x$varExp)})) %>% as_tibble()
ACMTF_CV_varExps = ACMTF_CV_varExps * 100
colnames(ACMTF_CV_varExps) = c("X1", "X2", "X3")
ACMTF_CV_varExps = ACMTF_CV_varExps %>% mutate(beta = ACMTF_CV_params)
a = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + scale_x_log10()
b = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X2)) + geom_point() + scale_x_log10()
c = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X3)) + geom_point() + scale_x_log10()
ggarrange(a,b,c,nrow=3)
ggarrange(a,b,c,nrow=3)
ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + scale_x_log10() + ylim(c(0,100))
a = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + scale_x_log10() + ylim(c(0,100))
b = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X2)) + geom_point() + scale_x_log10() + ylim(c(0,100))
c = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X3)) + geom_point() + scale_x_log10() + ylim(c(0,100))
ggarrange(a,b,c,nrow=3)
a = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X1 (%)")
b = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X2)) + geom_point() + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X2 (%)")
c = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X3)) + geom_point() + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X3 (%)")
ggarrange(a,b,c,nrow=3)
ACMTF_CV_params
max(ACMTF_CV_params)
min(ACMTF_CV_params)
ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + scale_x_log10() + xlim(c(1e-10,1e1)) + ylim(c(0,100)) + ylab("varExp X1 (%)")
ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + + xlim(c(1e-10,1e1)) + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X1 (%)")
ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + xlim(c(1e-10,1e1)) + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X1 (%)")
ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + xlim(c(1e-11,1e2)) + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X1 (%)")
a = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X1)) + geom_point() + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X1 (%)")
b = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X2)) + geom_point() + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X2 (%)")
c = ACMTF_CV_varExps %>% ggplot(aes(x=beta,y=X3)) + geom_point() + scale_x_log10() + ylim(c(0,100)) + ylab("varExp X3 (%)")
ggarrange(a,b,c,nrow=3)
ACMTF_CV_varExps
ACMTF_CV_varExps$beta
ACMTF_CV_varExps$beta == 1e-3
ACMTF_CV_varExps$beta <= 1e-2
ACMTF_CV_varExps$beta
ACMTF_CV_varExps[30,]
modelNumber = 30
model = ACMTF_CV_models[[30]]
a = cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
b = model$Fac[[8]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + scale_y_discrete(name="X block", labels=c("X3", "X2", "X1")) + ggtitle("Lambdas (incorrect model)")
c = cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
ggarrange(a,b,c)
a
ggarrange(a,b,c,nrow=1)
cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7)
c = cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Input", labels=c("Global1", "Global2", "Local1", "Local2", "Distinct1", "Distinct2", "Distinct3")) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
c
ggarrange(a,b,c)
ggarrange(a,b,c, nrow=1)
a = cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
b = model$Fac[[8]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + scale_y_discrete(name="X block", labels=c("X3", "X2", "X1"))
c = cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Input", labels=c("Global1", "Global2", "Local1", "Local2", "Distinct1", "Distinct2", "Distinct3")) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
ggarrange(a,b,c)
ggarrange(a,b,c,nrow=1)
b
cor(model$Fac[[1]], inputLoadings[[1]])
a = cbind(model$Fac[[1]][,1], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 1")
b = cbind(model$Fac[[2]][,1], inputLoadings[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 3")
c = cbind(model$Fac[[3]][,1], inputLoadings[[3]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 3")
a
b
c
a = cbind(model$Fac[[1]][,1], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 1")
b = cbind(model$Fac[[2]][,1], inputLoadings[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 3")
c = cbind(model$Fac[[3]][,1], inputLoadings[[3]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 3")
d = cbind(model$Fac[[4]][,1], inputLoadings[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 3")
e = cbind(model$Fac[[5]][,1], inputLoadings[[3]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 3")
ggarrange(a,b,c,d,e)
a = cbind(model$Fac[[1]][,1], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 1")
b = cbind(model$Fac[[2]][,1], inputLoadings[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X1") + ylab("Component 1")
c = cbind(model$Fac[[3]][,1], inputLoadings[[3]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X1") + ylab("Component 1")
d = cbind(model$Fac[[4]][,1], inputLoadings[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X2") + ylab("Component 1")
e = cbind(model$Fac[[5]][,1], inputLoadings[[3]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X2") + ylab("Component 1")
## Component 4
f = cbind(model$Fac[[1]][,4], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 1")
g = cbind(model$Fac[[6]][,4], inputLoadings[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X3") + ylab("Component 1")
h = cbind(model$Fac[[7]][,4], inputLoadings[[3]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X3") + ylab("Component 1")
i = empty
j = empty
ggarrange(a,b,c,d,e,f,g,h,i,j, nrow=2, ncol=5)
a = cbind(model$Fac[[1]][,1], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 1")
b = cbind(model$Fac[[2]][,1], inputLoadings[[2]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X1") + ylab("Component 1")
c = cbind(model$Fac[[3]][,1], inputLoadings[[3]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X1") + ylab("Component 1")
d = cbind(model$Fac[[4]][,1], inputLoadings[[2]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X2") + ylab("Component 1")
e = cbind(model$Fac[[5]][,1], inputLoadings[[3]][,2]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X2") + ylab("Component 1")
## Component 4
f = cbind(model$Fac[[1]][,4], inputLoadings[[1]][,1]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("a_global1") + ylab("Component 4")
g = cbind(model$Fac[[6]][,4], inputLoadings[[2]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("b_global1_X3") + ylab("Component 4")
h = cbind(model$Fac[[7]][,4], inputLoadings[[3]][,3]) %>% as_tibble() %>% ggplot(aes(x=V2,y=V1)) + geom_point() + xlab("c_global1_X3") + ylab("Component 4")
i = empty
j = empty
ggarrange(a,b,c,d,e,f,g,h,i,j, nrow=2, ncol=5)
cor(model$Fac[[1]][,6], inputLoadings[[1]])
cor(model$Fac[[2]][,6], inputLoadings[[2]])
cor(model$Fac[[3]][,6], inputLoadings[[3]])
ACMTF_CV_params
ACMTF_CV_params == 1
modelNumber = 1
model = ACMTF_CV_models[[1]]
a = cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
b = model$Fac[[8]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + scale_y_discrete(name="X block", labels=c("X3", "X2", "X1"))
c = cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Input", labels=c("Global1", "Global2", "Local1", "Local2", "Distinct1", "Distinct2", "Distinct3")) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
ggarrange(a,b,c)
ggarrange(a,b,c,nrow=1)
cor(model$Fac[[1]], inputLoadings[[1]])
round(cor(model$Fac[[1]], inputLoadings[[1]]), 2)
ACMTF_CV_params
modelNumber = 100
model = ACMTF_CV_models[[100]]
a = cor(model$Fac[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
b = model$Fac[[8]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Component number", labels=1:7) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + scale_y_discrete(name="X block", labels=c("X3", "X2", "X1"))
c = cor(model$Fac[[1]], inputLoadings[[1]]) %>% as_tibble() %>% mutate(index=1:7) %>% pivot_longer(-index) %>% mutate(index = factor(index, levels=c(7,6,5,4,3,2,1))) %>% ggplot(aes(y=index,x=as.factor(name),fill=value)) + geom_tile(col="black") + ylab("X block") + scale_x_discrete(name="Input", labels=c("Global1", "Global2", "Local1", "Local2", "Distinct1", "Distinct2", "Distinct3")) + scale_fill_gradient2(low="red",high="green",mid="grey",midpoint=0) + geom_text(aes(label=round(value,2))) + ylab("Component number")
ggarrange(a,b,c,nrow=1)
ACMTF_CV_models[[1]]
ACMTF_CV_models[[1]]$init
all.equal(ACMTF_CV_models[[1]]$init, ACMTF_CV_models[[2]]$init)
all.equal(ACMTF_CV_models[[1]]$init, ACMTF_CV_models[[3]]$init)
all.equal(ACMTF_CV_models[[1]]$init, ACMTF_CV_models[[4]]$init)
X1_final
as.tensor(X1_final)
k_unfold(as.tensor(X1_final), 1)
k_unfold(as.tensor(X1_final), 1) %>% dim
k_unfold(as.tensor(X1_final), 1)
svd(k_unfold(as.tensor(X1_final), 1))
svd(k_unfold(as.tensor(X1_final), 1)@data)
qr(k_unfold(as.tensor(X1_final), 1)@data)$rank
?qr
qr(k_unfold(as.tensor(X2_final), 1)@data)$rank
qr(k_unfold(as.tensor(X3_final), 1)@data)$rank
temp = qr(k_unfold(as.tensor(X1_final), 1)@data)
temp$qr
temp$qr %>% dim
temp$qr %>% head
temp$qr[1:5,1:5]
temp$qraux
temp.Q
temp.out
temp = qr(k_unfold(as.tensor(X1_final), 1)@data)
qr.q(temp)
qr.Q(temp)
Q=qr.Q(temp)
R=qr.R(temp)
Q
R
dim(Q)
dim(R)
Q %*% R
Q %*% R %>% dim
Q[,1:6]
t(Q) %*% Q
Q[,1:10]
norm(Q)
norm(Q[,1])
norm(Q[,1], "2")
norm(Q[,2], "2")
norm(Q[,20], "2")
?qr.Q
?qr
temp = qr(k_unfold(as.tensor(X1_final), 1)@data, LAPACK=TRUE)
temp$rank
temp = qr(k_unfold(as.tensor(X1_final), 1)@data)
temp$rank
pracma::gramSchmidt(k_unfold(as.tensor(X1_final), 1)@data)
pracma::gramSchmidt(k_unfold(as.tensor(X1_final), 1)@data, byrow=FALSE)
?pracma::gramSchmidt
Q
ACMTF_models_correct[[1]]$Fac[[1]][,1] %*% Q
ACMTF_models_correct[[1]]$Fac[[1]][,2] %*% Q
ACMTF_models_correct[[1]]$Fac[[1]][,3] %*% Q
cor(ACMTF_models_correct[[1]]$Fac[[1]], inputLoadings[[1]])
ACMTF_models_correct[[1]]$Fac[[1]][,7] %*% Q
max(abs(ACMTF_models_correct[[1]]$Fac[[1]][,7] %*% Q))
max(abs(ACMTF_models_correct[[1]]$Fac[[1]][,7] %*% Q[,1:5]))
ACMTF_models_correct[[1]]$Fac[[1]][,7] %*% Q[,1:5])
ACMTF_models_correct[[1]]$Fac[[1]][,7] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]][1,] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]][,1] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]][,2] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]][,3] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]][,4] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]][,5] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]][,6] %*% Q[,1:5]
ACMTF_models_correct[[1]]$Fac[[1]][,7] %*% Q[,1:5]
Xhat = Q[,1:5] %*% R[1:5,1:5]
Xhat
Q %*% R
Xhat = Q %*% R
X = k_unfold(as.tensor(X1_final), 1)@data
X - Xhat
res = X - Xhat
sum(res^2)
sum(res^2) / sum(X^2)
sum(X^2)
sum(Xhat^2)
